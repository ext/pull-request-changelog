name: Pull Requst Changelog
author: David Sveningsson
description: >
  Generate changelog from conventional changelog for using in a pull request comment.

branding:
  icon: git-pull-request
  color: blue

inputs:
  script-name:
    description: name of script to generate output
    required: false
    default: .github/changelog.mjs
  filename:
    description: name of temporary file generated by script
    required: false
    default: pr-changelog.md
  message-id:
    description: id passed to sticky-pull-request-commend
    required:

runs:
  using: composite
  steps:
    - name: generate changelog comment
      run: |
        git fetch origin ${{ github.event.pull_request.base.ref }}
        git fetch origin ${{ github.head_ref }}
        node {{ inputs.script-name }} origin/${{ github.event.pull_request.base.ref }} origin/${{ github.head_ref }} | tee {{ inputs.filename }}
    - name: sticky pull request comment
      uses: marocchino/sticky-pull-request-comment@v2
      with:
        header: ${{ inputs.message-id }}
        path: ${{ inputs.filename }}
